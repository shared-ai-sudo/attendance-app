# 出退勤打刻アプリ 仕様書

## 1. 目的

研修生が毎日の出勤・退勤時刻を記録し、LINE通知で学習時間を管理するアプリ

## 2. 使い方（基本の流れ）

1. **出勤するとき**
   - アプリを開く
   - 「出勤」ボタンを押す
   - 出勤時刻が記録される

2. **退勤するとき**
   - アプリを開く
   - 「退勤」ボタンを押す
   - 退勤時刻が記録される
   - 勤務時間が自動で計算される

3. **課題が完了したとき**
   - 「課題完了」ボタンを押す
   - LINEに完了報告が送られる

## 3. 画面の構成

### 3つのボタン

- **出勤ボタン**: 勤務を開始するときに押す
- **退勤ボタン**: 勤務を終了するときに押す
- **課題完了ボタン**: 課題が終わったときに押す

### ステータス表示

- 現在の状態が画面に表示される
  - 例: 「未出勤」「出勤中」「退勤済み」
- 出勤時刻・退勤時刻・勤務時間が表示される

## 4. データ項目

アプリで記録・管理するデータ:

| 項目名 | 説明 | 例 |
|--------|------|-----|
| 研修生ID | 研修生を識別する番号 | `001` |
| 氏名 | 研修生の名前 | `山田太郎` |
| 日付 | 出退勤した日 | `2025-10-23` |
| 出勤時刻 | 出勤ボタンを押した時刻 | `09:00` |
| 退勤時刻 | 退勤ボタンを押した時刻 | `17:00` |
| 勤務時間 | 退勤時刻 - 出勤時刻 | `8時間0分` |
| アプリURL | アプリのアドレス | `https://example.com/app` |
| 判定 | 勤務時間の評価 | `達成` / `未達成` |

## 5. ルール（制約事項）

### 出勤のルール

- **同じ日に2回出勤できない**
  - 1日1回まで出勤ボタンを押せる
  - すでに出勤済みの場合はエラーメッセージが表示される

### 退勤のルール

- **退勤前に必ず出勤が必要**
  - 出勤していない状態で退勤ボタンを押すとエラーになる
  - 先に出勤ボタンを押してください

### タイムゾーン

- **日本時間（Asia/Tokyo）で記録**
  - すべての時刻は日本標準時（JST）で保存される
  - サーバーが海外にあっても日本時間で正しく記録される

## 6. エラー表示の方針

### やさしい日本語で伝える

エラーが起きたときは、中高生にもわかる言葉で説明します:

- ❌ 悪い例: 「リクエストが失敗しました（Error Code: 400）」
- ⭕ 良い例: 「すでに今日は出勤しています。もう一度出勤ボタンは押せません。」

### 再試行ボタンを表示

- エラーメッセージと一緒に「もう一度試す」ボタンを表示
- ボタンを押すと、同じ操作をやり直せる
- ネットワークエラーなど一時的な問題に対応

### エラーメッセージの例

- 「先に出勤ボタンを押してください」
- 「インターネットに接続できません。もう一度試してください」
- 「データの保存に失敗しました。もう一度ボタンを押してください」

## 7. LINE通知の文面フォーマット

### ① 出勤通知

```
【出勤記録】

氏名: 山田太郎
日付: 2025年10月23日
出勤時刻: 09:00

今日も頑張りましょう！
```

### ② 退勤通知

```
【退勤記録】

氏名: 山田太郎
日付: 2025年10月23日
出勤時刻: 09:00
退勤時刻: 17:00
勤務時間: 8時間0分

お疲れ様でした！
```

### ③ 課題完了通知

```
【課題完了報告】

氏名: 山田太郎
日付: 2025年10月23日
出勤時刻: 09:00
退勤時刻: 17:00
勤務時間: 8時間0分
アプリURL: https://example.com/app
判定: 達成

課題が完了しました！
```

## 8. PWA要件（スマホアプリ化）

PWA（Progressive Web App）として動作させることで、ホーム画面から起動できるアプリのように使えます。

### manifest.json の役割

- **アプリの基本情報を設定**
  - アプリ名: 「出退勤打刻アプリ」
  - アイコン: ホーム画面に表示されるアイコン画像
  - 表示モード: スタンドアロン（ブラウザのアドレスバーを非表示）
  - 背景色・テーマカラー: アプリの見た目

### serviceWorker.js の役割

- **オフラインでも動作**
  - インターネットが切れても基本画面は表示される
  - キャッシュ機能でアプリの読み込みを高速化

- **バックグラウンド同期**
  - オフラインで押したボタンの記録を保持
  - ネット接続が復活したら自動でデータを送信

## 9. セキュリティ

### トークンの安全な管理

#### ❌ やってはいけないこと

- LINE通知用のトークンをフロントエンド（HTML/JavaScript）に直接書く
- ブラウザから誰でもトークンが見えてしまう危険性

#### ⭕ 正しい方法

- **GAS（Google Apps Script）のスクリプトプロパティに保存**
  - GASの管理画面で設定 → プロジェクトの設定 → スクリプトプロパティ
  - `LINE_TOKEN` という名前でトークンを保存
  - フロントエンドからは直接見えない

### トークンの使い方

```javascript
// GAS側のコード例
function getLineToken() {
  const properties = PropertiesService.getScriptProperties();
  return properties.getProperty('LINE_TOKEN');
}

function sendLineNotification(message) {
  const token = getLineToken();
  // トークンを使ってLINE通知を送信
}
```

### その他のセキュリティ対策

- データの送受信はHTTPS（暗号化通信）を使用
- 個人情報（氏名、ID）は必要最小限のみ保存
- 不正なアクセスを防ぐため、研修生ごとに認証を行う（必要に応じて）

---

## 補足説明

この仕様書に基づいてアプリを作ることで、研修生が簡単に出退勤を記録でき、学習時間を管理できるようになります。わからないことがあれば、各セクションを見直して確認してください。
