# 出退勤打刻アプリ デプロイ手順書

このドキュメントでは、出退勤打刻アプリを実際に動かすまでの手順を、初心者にもわかりやすく解説します。

---

## 📋 必要なもの

- Googleアカウント
- LINE Messaging APIのアカウント（LINEで通知を送るため）
- テキストエディタ（VSCodeなど）
- Webサーバー（GitHub Pages、Netlify、Vercelなど）

---

## ステップ1: LINE Messaging APIの設定

### 1-1. LINE Developersでチャネルを作成

1. [LINE Developers](https://developers.line.biz/ja/) にアクセス
2. 「ログイン」→ LINEアカウントでログイン
3. 「新規プロバイダー作成」→ プロバイダー名を入力（例: 出退勤アプリ）
4. 「Messaging API」を選択
5. チャネル情報を入力：
   - チャネル名: `出退勤打刻bot`
   - チャネル説明: `研修生の出退勤を記録するbot`
6. 「作成」をクリック

### 1-2. チャネルアクセストークンを取得

1. 作成したチャネルの「Messaging API設定」タブを開く
2. 「チャネルアクセストークン（長期）」の「発行」ボタンをクリック
3. トークンをコピー（後で使います）

### 1-3. グループIDを取得

1. LINEアプリで通知を受け取りたいグループを作成
2. 作成したbotをグループに招待
3. グループIDを取得する方法：
   - 一時的に「Webhook URL」を設定してメッセージを送信
   - または、LINE公式の[Group ID取得ツール](https://developers.line.biz/ja/docs/messaging-api/group-chats/)を使用

---

## ステップ2: Google Spreadsheetsの設定

### 2-1. スプレッドシートを作成

1. [Google Drive](https://drive.google.com/) にアクセス
2. 「新規」→「Google スプレッドシート」→「空白のスプレッドシート」
3. スプレッドシート名を `出退勤記録` に変更

### 2-2. Apps Scriptを開く

1. スプレッドシート上部のメニュー → 「拡張機能」→「Apps Script」
2. 新しいタブでApps Scriptエディタが開きます

### 2-3. setup.gs をコピー

1. `setup.gs` の内容をすべてコピー
2. Apps Scriptエディタに貼り付け（既存の `function myFunction() {}` は削除）
3. 「保存」アイコンをクリック（フロッピーディスクマーク）

### 2-4. 初期セットアップを実行

1. 上部の実行する関数を選択 → `setupSpreadsheet` を選択
2. 「実行」ボタンをクリック
3. 初回実行時、権限の確認画面が表示されます：
   - 「権限を確認」→ Googleアカウントを選択
   - 「詳細」→「（安全ではないページ）に移動」→「許可」
4. 「セットアップ完了」のメッセージが表示されればOK

### 2-5. スプレッドシートIDをコピー

1. スプレッドシートのURLを確認：
   ```
   https://docs.google.com/spreadsheets/d/【この部分がID】/edit
   ```
2. IDをコピーしてメモ帳などに保存

---

## ステップ3: Google Apps Scriptの設定

### 3-1. Code.gs を追加

1. Apps Scriptエディタに戻る
2. 左側の「ファイル」→「＋」ボタン → 「スクリプト」
3. ファイル名を `Code.gs` に変更
4. `Code.gs` の内容をすべてコピー＆ペースト
5. 「保存」をクリック

### 3-2. スクリプトプロパティを設定

1. Apps Scriptエディタで、左側の「⚙️ プロジェクトの設定」をクリック
2. 下にスクロールして「スクリプトプロパティ」セクションを探す
3. 「スクリプトプロパティを追加」をクリックして以下を追加：

| プロパティ | 値 |
|------------|-----|
| `SHEET_ID` | スプレッドシートID（ステップ2-5でコピーしたもの） |
| `LINE_TOKEN` | LINEチャネルアクセストークン（ステップ1-2でコピーしたもの） |
| `LINE_GROUP_ID` | LINEグループID（ステップ1-3で取得したもの） |

4. 「スクリプトプロパティを保存」をクリック

### 3-3. 設定を確認

1. 実行する関数 → `checkScriptProperties` を選択
2. 「実行」をクリック
3. すべて「✅ 設定済み」と表示されればOK

---

## ステップ4: GASをWebアプリとしてデプロイ

### 4-1. デプロイ

1. Apps Scriptエディタ右上の「デプロイ」→「新しいデプロイ」
2. 「種類の選択」→「ウェブアプリ」を選択
3. 設定を入力：
   - **説明**: `出退勤アプリv1`
   - **次のユーザーとして実行**: `自分`
   - **アクセスできるユーザー**: `全員`
4. 「デプロイ」をクリック
5. 「ウェブアプリ URL」をコピー（後で使います）

例: `https://script.google.com/macros/s/XXXXX/exec`

---

## ステップ5: フロントエンドの設定

### 5-1. index.html を編集

1. `index.html` を開く
2. 315行目付近の `CONFIG` を編集：

```javascript
const CONFIG = {
  gasUrl: 'https://script.google.com/macros/s/XXXXX/exec', // ステップ4でコピーしたURL
  userId: 'user01', // 研修生ID
  userName: '山田太郎' // 研修生名
};
```

### 5-2. アイコン画像を準備

PWAとして動作させるには、アイコン画像が必要です：

- `icon192.png` (192x192ピクセル)
- `icon512.png` (512x512ピクセル)

簡単な方法：
1. [Canva](https://www.canva.com/) で正方形の画像を作成
2. 出退勤アプリのアイコンをデザイン（例: 時計のマーク）
3. PNGでダウンロードしてリサイズ

---

## ステップ6: Webサーバーにデプロイ

### 方法1: GitHub Pages（推奨）

1. GitHubにリポジトリを作成
2. 以下のファイルをアップロード：
   - `index.html`
   - `manifest.json`
   - `service-worker.js`
   - `icon192.png`
   - `icon512.png`
3. Settings → Pages → Source を `main` ブランチに設定
4. 数分後、URLが発行される: `https://username.github.io/repo-name/`

### 方法2: Netlify

1. [Netlify](https://www.netlify.com/) にアクセス
2. 「Add new site」→「Deploy manually」
3. 上記5ファイルをドラッグ＆ドロップ
4. 自動でURLが発行される

### 方法3: Vercel

1. [Vercel](https://vercel.com/) にアクセス
2. プロジェクトをGitHubからインポート
3. 自動デプロイ

---

## ステップ7: スマホにPWAとして追加

### iPhoneの場合

1. Safariでアプリを開く
2. 下部の「共有」アイコンをタップ
3. 「ホーム画面に追加」をタップ
4. アプリ名を確認して「追加」

### Androidの場合

1. Chromeでアプリを開く
2. メニュー（3点アイコン）→「ホーム画面に追加」
3. 「追加」をタップ

---

## ステップ8: 動作確認

### 8-1. 出勤テスト

1. アプリを開く
2. 「出勤」ボタンをタップ
3. LINEグループに通知が届くか確認
4. スプレッドシートに記録されているか確認

### 8-2. 退勤テスト

1. 「退勤」ボタンをタップ
2. 勤務時間が正しく計算されているか確認
3. LINE通知を確認

### 8-3. 課題完了テスト

1. 「課題完了」ボタンをタップ
2. アプリURLを入力（テスト用: `https://example.com`）
3. LINE通知とスプレッドシートを確認

---

## トラブルシューティング

### LINE通知が届かない

- `LINE_TOKEN` が正しいか確認
- `LINE_GROUP_ID` が正しいか確認
- botがグループに招待されているか確認

### 「通信に失敗しました」と表示される

- `gasUrl` が正しいか確認（末尾に余分な空白やスラッシュがないか）
- GASのデプロイで「アクセスできるユーザー」が「全員」になっているか確認

### スプレッドシートに記録されない

- `SHEET_ID` が正しいか確認
- Apps Scriptの実行ログを確認（「表示」→「ログ」）

### PWAとして追加できない

- HTTPSで配信されているか確認（GitHub PagesやNetlifyは自動でHTTPS）
- `manifest.json` と `service-worker.js` が正しく配置されているか確認

---

## 更新方法

### GASを更新した場合

1. Apps Scriptエディタで「デプロイ」→「デプロイを管理」
2. 鉛筆アイコンをクリック
3. 「バージョン」を「新バージョン」に変更
4. 「デプロイ」をクリック

### フロントエンドを更新した場合

1. ファイルを編集
2. GitHub、Netlify、Vercelに再アップロード
3. スマホでアプリを開き、リロード（PWAキャッシュをクリア）

---

## まとめ

これで出退勤打刻アプリのデプロイが完了しました！

わからないことがあれば、各ステップを見直して確認してください。
